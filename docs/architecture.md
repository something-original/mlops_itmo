Схема архитектуры
https://drive.google.com/file/d/1P17FDdFxDRofpgZXjbEVwjHOprQhYrKr/view?usp=sharing
# Архитектура системы

## Основные компоненты

1. **UI (JS)** - Пользовательский интерфейс для взаимодействия с системой.
2. **API Gateway (Java Spring Boot)** - Центральная точка маршрутизации и обработки запросов:
    - Авторизация пользователя.
    - Загрузка документов.
    - Запуск проверок и отображение отчетов.
3. **Auth Server (Java Spring Boot)** - Сервис аутентификации и авторизации пользователей.
4. **База данных (PostgresDB)** - Хранение данных о пользователях и их ролях.
5. **Report Generation Service (Java Spring Boot)** - Генерация отчетов на основе загруженных файлов.
6. **База данных (MongoDB)** - Хранение файлов сканов документов, результатов распознавания и аналитики форм.

## Взаимодействие с очередями и анализом

1. **Очередь на распознавание файлов (Kafka)** - Очередь для задач по распознаванию текста.
2. **OCR Service (Python, ML)** - Сервис, выполняющий OCR-распознавание документов:
    - Публикует событие завершения распознавания.
3. **Очередь на семантический анализ (Kafka)** - Очередь для задач по семантическому анализу документов.
4. **Structure Analysis Service (Python, ML)** - Сервис, выполняющий семантический анализ:
    - Публикует событие завершения анализа.
5. **Очередь на генерацию отчета (Kafka)** - Очередь для запуска процесса генерации отчета.

## Вспомогательные сервисы

1. **Parser Service (Java Spring Boot)** - Обновляет аналитику и формы, отправляя данные в Legal Repository.
2. **Legal Repository** - Хранилище юридической информации и форм.
3. **Adapter Service (Java Spring Boot)** - Адаптер для интеграции с другими системами, предоставляющий API и токены:
    - Интеграция с **HR System**.
    - Интеграция с **Factory ERP**.

## Процесс работы

1. Пользователь через UI загружает документ в систему.
2. API Gateway перенаправляет запросы на нужные сервисы:
    - Авторизация пользователя через Auth Server.
    - Запуск проверки и передача документа в очередь на распознавание.
3. OCR Service выполняет распознавание текста и публикует результат.
4. Результат поступает в очередь на семантический анализ.
5. Structure Analysis Service анализирует структуру документа и публикует событие окончания.
6. Документ поступает в очередь на генерацию отчета, где Report Generation Service создает итоговый отчет, доступный пользователю через UI.


![Архитектура](./Архитектура%20решения.jpg)

```
project-root/
│
├── api-gateway/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── ru/aidoc/apigateway/
│   │   │   │       ├── config/
│   │   │   │       ├── controller/
│   │   │   │       ├── service/
│   │   │   │       └── util/
│   │   │   └── resources/
│   │   │       └── application.yml
│   └── Dockerfile
│
├── auth-server/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── ru/aidoc/authserver/
│   │   │   │       ├── config/
│   │   │   │       ├── controller/
│   │   │   │       ├── service/
│   │   │   │       └── util/
│   │   │   └── resources/
│   │   │       └── application.yml
│   └── Dockerfile
│
├── report-generation-service/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── ru/aidoc/reportgeneration/
│   │   │   │       ├── config/
│   │   │   │       ├── controller/
│   │   │   │       ├── service/
│   │   │   │       └── util/
│   │   │   └── resources/
│   │   │       └── application.yml
│   └── Dockerfile
│
├── parser-service/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── ru/aidoc/parserservice/
│   │   │   │       ├── config/
│   │   │   │       ├── service/
│   │   │   │       └── util/
│   │   │   └── resources/
│   │   │       └── application.yml
│   └── Dockerfile
│
├── adapter-service/
│   ├── src/
│   │   ├── main/
│   │   │   ├── java/
│   │   │   │   └── ru/aidoc/adapterservice/
│   │   │   │       ├── config/
│   │   │   │       ├── controller/
│   │   │   │       ├── service/
│   │   │   │       └── util/
│   │   │   └── resources/
│   │   │       └── application.yml
│   └── Dockerfile
│
├── ocr-service/
│   ├── src/
│   │   ├── main/
│   │   │   ├── python/
│   │   │   │   ├── ocr_service.py
│   │   │   │   ├── config.py
│   │   │   │   └── utils/
│   │   │   └── resources/
│   └── Dockerfile
│
├── structure-analysis-service/
│   ├── src/
│   │   ├── main/
│   │   │   ├── python/
│   │   │   │   ├── analysis_service.py
│   │   │   │   ├── config.py
│   │   │   │   └── utils/
│   │   │   └── resources/
│   └── Dockerfile
│
├── config/
│   ├── kafka/
│   │   ├── kafka-config.yml
│   │   └── kafka-topics.yml
│   ├── mongo/
│   │   └── mongo-init.js
│   └── postgres/
│       └── postgres-init.sql
│
├── common-libraries/
│   ├── utils/
│   │   ├── logging/
│   │   ├── error-handling/
│   │   └── kafka/
│   ├── models/
│   └── Dockerfile
│
├── docs/
│   ├── frontend.md
│   ├── backend.md
│   ├── ocr.md
│   ├── kafka.md
│   ├── development-guidelines.md
│   └── semantic-analysis.md
│
├── docker-compose.yml
└── README.md


```
Объяснение Архитектуры
Frontend (JavaScript):

Язык: JavaScript
Описание: Пользовательский интерфейс, позволяющий пользователям загружать документы в различных форматах (PDF, DOCX и другие), а также просматривать отчеты и рекомендации после обработки.
API Gateway (Java):

Язык: Java
Описание: Управляет входящими запросами от фронтенда, выполняет маршрутизацию, балансировку нагрузки и аутентификацию пользователей. Использует gRPC для внутренней коммуникации с микросервисами.
Микросервисы:

OCR Service (Python, ML):

Язык: Python
Описание: Ответственный за преобразование изображений или сканированных документов в машиночитаемый текст с использованием ML моделей.
Технологии: Python, ML библиотеки
Хранение: Сохраняет сканы документов в MongoDB.
Коммуникация: Использует gRPC для взаимодействия с API Gateway и публикует события в Apache Kafka.
Structure Analysis Service (Python, ML):

Язык: Python
Описание: Анализирует структуру документов и ищет различия между загруженными документами и типовыми формами.
Технологии: Python, ML библиотеки
Коммуникация: Подписывается на события из Kafka и публикует результаты анализа обратно в Kafka.
Database Service (Java, Web):

Язык: Java
Описание: Обеспечивает доступ к базам данных MongoDB и PostgresDB, управляет информацией о пользователях и ролях.
Технологии: Java, Spring Boot или другой Java фреймворк
Хранение: Использует PostgresDB для хранения информации о пользователях и ролях.
Коммуникация: Использует REST API для взаимодействия с API Gateway.
Report Generation Service (Java, Web):

Язык: Java
Описание: Генерирует отчеты о выявленных несоответствиях, включая тип, местоположение и рекомендации.
Технологии: Java, Spring Boot или другой Java фреймворк
Коммуникация: Подписывается на события из Kafka и отправляет результаты пользователям через API Gateway.
Adapter Service (Java, Web):

Язык: Java
Описание: Обеспечивает интеграцию с внешними системами, такими как HR-системы или юридические репозитории.
Технологии: Java, Spring Boot или другой Java фреймворк
Коммуникация: Использует REST или gRPC для взаимодействия с внешними системами.
Базы данных:

MongoDB:

Использование: Хранение сканов документов (изображений, PDF и других форматов).
Описание: Документо-ориентированная база данных, идеально подходящая для хранения файлов и метаданных.
PostgresDB:

Использование: Хранение информации о пользователях и ролях в системе.
Описание: Реляционная база данных, обеспечивающая надежное хранение структурированных данных.
Apache Kafka:

Использование: Обеспечение асинхронной, масштабируемой и надежной коммуникации между микросервисами.
Примеры использования:
Документ Процессинг: После обработки OCR Service публикует событие о завершении обработки документа.
Анализ Структуры: Structure Analysis Service подписывается на это событие для начала анализа.
Генерация Отчета: После завершения анализа Structure Analysis Service публикует событие, на которое Report Generation Service подписывается для создания отчета.
gRPC:

Использование: Высокопроизводительная коммуникация между API Gateway и микросервисами.
Примеры использования:
Взаимодействие с OCR Service: API Gateway использует gRPC для отправки изображений/сканов в OCR Service.
Взаимодействие между Микросервисами: Высокопроизводительные вызовы между микросервисами, например, запросы на анализ или генерацию отчетов.
Технологии и Языки Программирования:

Frontend: JavaScript
Микросервисы ML (OCR и Structure Analysis): Python
Микросервисы Web (Database, Report Generation, Adapter): Java
API Gateway: Java
Преимущества Обновленной Архитектуры
Масштабируемость: Использование микросервисов позволяет масштабировать отдельные компоненты независимо в зависимости от нагрузки.
Надежность: Apache Kafka обеспечивает надежную передачу сообщений между сервисами, предотвращая потерю данных.
Высокопроизводительная Коммуникация: gRPC обеспечивает низкую задержку и высокую пропускную способность для внутренних вызовов между сервисами.
Разделение Хранения Данных: Использование MongoDB и PostgresDB позволяет эффективно хранить как неструктурированные данные (сканы документов), так и структурированные данные (пользователи и роли).
Гибкость Интеграции: Adapter Service обеспечивает легкую интеграцию с внешними системами, что позволяет расширять функциональность без изменения основных компонентов.
Использование Подходящих Технологий: Выбор языков программирования и технологий соответствует задачам каждого сервиса, обеспечивая оптимальную производительность и разработку.
Рекомендации по Развертыванию
Контейнеризация: Используйте Docker для контейнеризации микросервисов, что облегчит развертывание и управление.
Оркестрация: Применяйте Kubernetes для управления кластером микросервисов, обеспечивая автоматическое масштабирование и управление ресурсами.
Мониторинг и Логирование: Внедрите системы мониторинга (например, Prometheus и Grafana) и централизованного логирования (например, ELK Stack) для отслеживания состояния системы и быстрого выявления проблем.
Безопасность: Обеспечьте безопасную коммуникацию между сервисами с помощью TLS и аутентификацию пользователей через API Gateway.